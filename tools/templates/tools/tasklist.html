{% extends 'base.html' %}

{% block javascript %}
    <script type="text/javascript">

    var list = ["This is a task"];

    if (!localStorage.getItem('taskList')){
        localStorage.setItem('taskList', JSON.stringify(list));
    }

    var taskList = JSON.parse(localStorage.getItem('taskList'));

    document.addEventListener('DOMContentLoaded', () => {

        if(document.getElementById("task_input").value=="" || document.getElementById("task_input").value==" "){
            document.getElementById("text_submit").disabled = true;
        }

        document.getElementById("task_div").innerHTML = '';

        for(var i = 0; i < taskList.length; i++){
            create_task(taskList[i]);
        }

        document.getElementsByName('task').forEach(function(checkbox) {
            checkbox.onclick = function() {
                this.parentElement.style.opacity = "0";
                alert(this.value);
                var index = taskList.indexOf(this.value);
                alert(index);
                if (index > -1) {
                  taskList.splice(index, 1);
                }
                localStorage.setItem('taskList', JSON.stringify(taskList));
            }
        });
    });
    function create_task(input_task) {

        if(input_task=="This is a task"){
            return;
        }

        var task = input_task;
        var label = document.createElement("label");
        var input = document.createElement("input");
        var br = document.createElement("br");

        input.setAttribute('type', "checkbox");
        input.setAttribute('name', "task");
        input.setAttribute('value', task);

        label.appendChild(input);
        label.innerHTML += task;

        document.getElementById("task_div").appendChild(label);
        document.getElementById("task_div").appendChild(br);
    }
    function new_task() {
        var task = document.getElementById("task_input").value;
        create_task(task);
        taskList.push(task);
        localStorage.setItem('taskList', JSON.stringify(taskList));
        document.getElementById("task_input").value = '';
    }
    function text_change() {
        if(document.getElementById("task_input").value=="" || document.getElementById("task_input").value==" "){
                document.getElementById("text_submit").disabled = true;
        }
        else{
            document.getElementById("text_submit").disabled = false;
        }
    }

    </script>
{% endblock %}

{% block title %}
Task List
{% endblock %}

{% block body %}
    <h2>Task List<br></h2>
    <br>
    <input type="text" id="task_input" placeholder = "Enter a Task" onkeyup="text_change();"/>
    <input type="submit" value="Submit" onclick = "new_task()" id='text_submit'/>
    <br>
    <br>
    <div id ='task_div'></div>

{% endblock %}