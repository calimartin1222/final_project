{% extends 'base.html' %}

{% block javascript %}
    <script type="text/javascript">

    var list = ["This is a task"];

    if (!localStorage.getItem('taskList')){
        localStorage.setItem('taskList', JSON.stringify(list));
    }

    var taskList = JSON.parse(localStorage.getItem('taskList'));

    document.addEventListener('DOMContentLoaded', () => {

        if(document.getElementById("task_input").value=="" || document.getElementById("task_input").value==" "){
            document.getElementById("text_submit").disabled = true;
        }

        document.getElementById("task_div").innerHTML = '';

        for(var i = 0; i < taskList.length; i++){
            create_task(taskList[i]);
        }

        document.getElementsByName('task').forEach(function(checkbox) {
            checkbox.onclick = function() {
                // var crossed = this.parentElement.innerHTML.strike();
                // this.checked = true;
                // var button = document.createElement("button");
                // button.setAttribute("type", "button");
                // button.setAttribute("class", "btn btn-danger");
                // button.setAttribute("id", 'delete');

                // var span = document.createElement("span");
                // span.setAttribute("aria-hidden", "true");
                // span.setAttribute("class", "glyphicon glyphicon-trash");

                // button.appendChild(span);
                // button.innerHTML = 'Delete';

                // this.parentElement.appendChild(button);
                // this.parentElement.text = crossed;
                this.parentElement.style.opacity = "0";
                var index = taskList.indexOf(this.value);
                if (index > -1) {
                  taskList.splice(index, 1);
                }
                localStorage.setItem('taskList', JSON.stringify(taskList));
            }
        });
    });

    // function delete_task() {
    //
    // }

    function create_task(input_task) {

        if(input_task=="This is a task"){
            return;
        }

        var task = input_task;
        var label = document.createElement("label");
        var input = document.createElement("input");
        var br = document.createElement("br");

        label.setAttribute('class', 'custom-control-label');

        input.setAttribute('type', "checkbox");
        input.setAttribute('name', "task");
        input.setAttribute('value', task);
        input.setAttribute('class', 'custom-control-input');

        label.appendChild(input);
        label.innerHTML += task;

        document.getElementById("task_div").appendChild(label);
        document.getElementById("task_div").appendChild(br);
    }
    function new_task() {
        var task = document.getElementById("task_input").value;
        create_task(task);
        taskList.push(task);
        localStorage.setItem('taskList', JSON.stringify(taskList));
        document.getElementById("task_input").value = '';
    }
    function text_change() {
        if(document.getElementById("task_input").value=="" || document.getElementById("task_input").value==" "){
                document.getElementById("text_submit").disabled = true;
        }
        else{
            document.getElementById("text_submit").disabled = false;
        }
    }

    </script>
{% endblock %}

{% block title %}
Task List
{% endblock %}

{% block body %}
    <h2>Task List<br></h2>
    <br>
    <input type="text" id="task_input" placeholder = "Enter a Task" onkeyup="text_change();"/>
    <input type="submit" value="Submit" onclick = "new_task()" id='text_submit'/>
    <br>
    <br>
    <div class="custom-control custom-checkbox" id ='task_div'></div>

{% endblock %}